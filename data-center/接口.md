# 数据库表

## forecastcell表

| 字段名称             | 类型         | 约束           | 说明                                            |
| -------------------- | ------------ | -------------- | ----------------------------------------------- |
| id                   | int          | Not NULL /主键 | 自增主键                                        |
| type                 | int          | Not NULL       | 0代表service，1代表node                         |
| cell_id              | Varchar(250) | Not NULL       | 服务:namespace+serviceName,节点:hostIp+hostName |
| forecasting_index    | Varchar(50)  | Not NULL       | 预测的指标名称                                  |
| time_interval        | int          | Not NULL       | 数据的时间间隔                                  |
| number_of_per_period | int          | Not NULL       | 每个周期内数据点的个数,没有周期则为1            |
| forecasting_model    | Varchar(50)  |                | 预测的算法模型                                  |
| model_params         | Varchar(512) |                | 算法模型参数                                    |
| forecasting_end_time | date         |                | 预测到那个时间点                                |

## service表

| 字段名称      | 类型        | 约束           | 说明                                                      |
| ------------- | ----------- | -------------- | --------------------------------------------------------- |
| service_id    | Varchar(50) | Not NULL /主键 | 标识Service主键（随机数生成）                             |
| namespace     | Varchar(50) | Not NULL       | Service所属namespace                                      |
| service_name  | Varchar(50) | Not NULL       | 服务名                                                    |
| cluster_ip    | Varchar(50) | Not NULL       | 服务内部IP                                                |
| owner_type    | Varchar(30) |                | 部署服务类型(deployment/DaemonSet)                        |
| owner_name    | Varchar(30) |                | 部署名称,例如nginx-deployment                             |
| cpu_request   | SMALLINT    |                | 推荐其yaml配置文件cpuRequest值                            |
| cpu_limit     | SMALLINT    |                | 推荐其yaml配置文件cpuLimit值                              |
| mem_request   | SMALLINT    |                | 推荐其yaml配置文件memRequest值                            |
| mem_limit     | SMALLINT    |                | 推荐其yaml配置文件memLimit值                              |
| period        | int         |                | 以分钟为单位                                              |
| response_time | Varchar(10) |                | 服务合理响应时间，单位为s                                 |
| type          | TINYINT     | 取值：1/2/3/4  | 1.CPU密集型/2.mem密集型/3.网络上传密集型/4.网络下载密集型 |

# 监控模块数据接口

## 1、一条service数据写入

PUT /service

| 请求参数        | 必选 | 类型       | 说明        |
| --------------- | ---- | ---------- | ----------- |
| （serviceData） | true | Json字符串 | service数据 |

| 返回字段  | 类型    | 说明             |
| --------- | ------- | ---------------- |
| isSucceed | Boolean | 返回是否写入成功 |

请求示例：

```json
    {
        "namespace": "hadoop",
        "serviceName": "hadoop-datanode-web",
        "clusterIP": "10.97.210.52",
        "nodePort": "30011",
        "serviceType": "NodePort",
        "onlineType": null,
        "podNums": null,
        "podList": [
            "hadoop-datanode-0",
            "hadoop-datanode-1"
        ],
        "cpuUsage": 0.0022282224041666986,
        "memUsage": 3.84671744E8,
        "diskUsage": 0.0,
        "requestBytes": 1782744.0,
        "responseBytes": 1225023.0,
        "requestConnections": 0,
        "netErrors": null,
        "responseTime": null,
        "application": null,
        "resourceKind": null,
        "resourceName": null,
        "volumeType": "C",
        "volumeUsage": 0.8
    }
```

返回示例：

```json
{
    "isSucceed":true
}
```

## 2、service数组写入

PUT /services

| 请求参数            | 必选 | 类型     | 说明        |
| ------------------- | ---- | -------- | ----------- |
| （serviceData数组） | true | Json数组 | service数据 |

| 返回字段  | 类型    | 说明             |
| --------- | ------- | ---------------- |
| isSucceed | Boolean | 返回是否写入成功 |

请求示例：

```json
[
	{
        "namespace": "hadoop",
        "serviceName": "hadoop-datanode-web",
        "clusterIP": "10.97.210.52",
        "nodePort": "30011",
        "serviceType": "NodePort",
        "onlineType": null,
        "podNums": null,
        "podList": [
            "hadoop-datanode-0",
            "hadoop-datanode-1"
        ],
        "cpuUsage": 0.0022282224041666986,
        "memUsage": 3.84671744E8,
        "diskUsage": 0.0,
        "requestBytes": 1782744.0,
        "responseBytes": 1225023.0,
        "requestConnections": 0,
        "netErrors": null,
        "responseTime": null,
        "application": null,
        "resourceKind": null,
        "resourceName": null,
        "volumeType": "C",
        "volumeUsage": 0.8
    },
    {
        "namespace": "hadoop",
        "serviceName": "hadoop-datanode",
        "clusterIP": "None",
        "nodePort": "null",
        "serviceType": "ClusterIP",
        "onlineType": null,
        "podNums": null,
        "podList": [
            "hadoop-datanode-0",
            "hadoop-datanode-1"
        ],
        "cpuUsage": 0.0022282224041666986,
        "memUsage": 3.84671744E8,
        "diskUsage": 0.0,
        "requestBytes": 1782744.0,
        "responseBytes": 1225023.0,
        "requestConnections": 0,
        "netErrors": null,
        "responseTime": null,
        "application": null,
        "resourceKind": null,
        "resourceName": null,
        "volumeType": "C",
        "volumeUsage": 0.8
    }
]
```

返回示例：

```json
{
    "isSucceed":true
}
```

## 3、一条node数据写入

PUT /node

| 请求参数     | 必选 | 类型       | 说明     |
| ------------ | ---- | ---------- | -------- |
| （nodeData） | true | Json字符串 | node数据 |

| 返回字段  | 类型    | 说明             |
| --------- | ------- | ---------------- |
| isSucceed | Boolean | 返回是否写入成功 |

请求示例：

```json
    {
        "nodeName": "10.10.101.65-share",
        "nodeIP": "10.10.101.65",
        "cpuCores": 2.0,
        "cpuUsage": 1.9359166666666678,
        "allocatableCpuCores": 2.0,
        "memUsage": 1.23123712E9,
        "allocatableMem": 3.672203264E9,
        "memMaxCapacity": 3.975241728E9,
        "diskUsage": 1.86394959872E11,
        "diskMaxCapacity": 1.792956416E11,
        "netBandwidth": 25661.05833333333,
        "allocatablePods": 110.0,
        "podMaxCapacity": 110.0,
        "condition": "Ready",
        "labels": {
            "HarmonyCloud_Status": "C",
            "alpha.kubernetes.io/fluentd-ds-ready": "true",
            "beta.kubernetes.io/arch": "amd64",
            "beta.kubernetes.io/os": "linux",
            "harmonycloud.cn/group": "first",
            "harmonycloud.cn/redis": "redis-master1",
            "harmonycloud.cn/redis-cluster": "0",
            "harmonycloud.cn/redis-cluster1": "true",
            "kubernetes.io/hostname": "10.10.101.65-share",
            "unique": "share65"
        },
        "unschedulable": false,
        "usedPorts": null,
        "taints": "[]",
        "imageStates": null,
        "requestedVolumes": 0.0,
        "allocatableVolumesCount": 0.0,
        "nodeConditions": {
            "type": "Ready",
            "status": "True"
        },
        "preferAvoidPodsAnnotationKey": ""
    }
```

返回示例：

```json
{
    "isSucceed":true
}
```

## 4、node数组写入

PUT /nodes

| 请求参数         | 必选 | 类型     | 说明     |
| ---------------- | ---- | -------- | -------- |
| （nodeData数组） | true | Json数组 | node数据 |

| 返回字段  | 类型    | 说明             |
| --------- | ------- | ---------------- |
| isSucceed | Boolean | 返回是否写入成功 |

请求示例：

```json
[
	{
        "nodeName": "10.10.101.65-share",
        "nodeIP": "10.10.101.65",
        "cpuCores": 2.0,
        "cpuUsage": 1.9359166666666678,
        "allocatableCpuCores": 2.0,
        "memUsage": 1.23123712E9,
        "allocatableMem": 3.672203264E9,
        "memMaxCapacity": 3.975241728E9,
        "diskUsage": 1.86394959872E11,
        "diskMaxCapacity": 1.792956416E11,
        "netBandwidth": 25661.05833333333,
        "allocatablePods": 110.0,
        "podMaxCapacity": 110.0,
        "condition": "Ready",
        "labels": {
            "HarmonyCloud_Status": "C",
            "alpha.kubernetes.io/fluentd-ds-ready": "true",
            "beta.kubernetes.io/arch": "amd64",
            "beta.kubernetes.io/os": "linux",
            "harmonycloud.cn/group": "first",
            "harmonycloud.cn/redis": "redis-master1",
            "harmonycloud.cn/redis-cluster": "0",
            "harmonycloud.cn/redis-cluster1": "true",
            "kubernetes.io/hostname": "10.10.101.65-share",
            "unique": "share65"
        },
        "unschedulable": false,
        "usedPorts": null,
        "taints": "[]",
        "imageStates": null,
        "requestedVolumes": 0.0,
        "allocatableVolumesCount": 0.0,
        "nodeConditions": {
            "type": "Ready",
            "status": "True"
        },
        "preferAvoidPodsAnnotationKey": ""
    },
    {
        "nodeName": "10.10.101.66-share",
        "nodeIP": "10.10.101.66",
        "cpuCores": 2.0,
        "cpuUsage": 1.9906666666666653,
        "allocatableCpuCores": 2.0,
        "memUsage": 1.1128832E9,
        "allocatableMem": 3.672203264E9,
        "memMaxCapacity": 3.975241728E9,
        "diskUsage": 1.86394959872E11,
        "diskMaxCapacity": 1.79313938432E11,
        "netBandwidth": 10780.425,
        "allocatablePods": 110.0,
        "podMaxCapacity": 110.0,
        "condition": "Ready",
        "labels": {
            "HarmonyCloud_Status": "C",
            "alpha.kubernetes.io/fluentd-ds-ready": "true",
            "beta.kubernetes.io/arch": "amd64",
            "beta.kubernetes.io/os": "linux",
            "harmonycloud.cn/group": "first",
            "harmonycloud.cn/redis": "redis-master2",
            "harmonycloud.cn/redis-cluster1": "true",
            "kubernetes.io/hostname": "10.10.101.66-share",
            "unique": "share66"
        },
        "unschedulable": false,
        "usedPorts": null,
        "taints": "[]",
        "imageStates": null,
        "requestedVolumes": 0.0,
        "allocatableVolumesCount": 0.0,
        "nodeConditions": {
            "type": "Ready",
            "status": "True"
        },
        "preferAvoidPodsAnnotationKey": ""
    }
]
```

返回示例：

```json
{
    "isSucceed":true
}
```

## 5、一条pod数据写入

PUT /pod

| 请求参数    | 必选 | 类型       | 说明    |
| ----------- | ---- | ---------- | ------- |
| （podData） | true | Json字符串 | pod数据 |

| 返回字段  | 类型    | 说明             |
| --------- | ------- | ---------------- |
| isSucceed | Boolean | 返回是否写入成功 |

请求示例：

```json
    {
        "podName": "redis-master-8565d89ff7-8brtd",
        "podIp": "10.168.172.163",
        "nodeName": "10.10.101.65-share",
        "serviceName": "",
        "namespace": "gt-qas",
        "onlineType": "",
        "resourceKind": "ReplicaSet",
        "resourceName": "redis-master-8565d89ff7",
        "state": "Running",
        "startTime": "1541429436",
        "imageName": "10.10.103.29/onlineshop/redis-master:latest",
        "cpuUsage": 0.001069171404166669,
        "cpuRequest": 0.5,
        "cpuLimit": 0.5,
        "memUsage": 1.632256E7,
        "memRequest": 5.36870912E8,
        "memLimit": 5.36870912E8,
        "volumeType": "",
        "volumeUsage": 0.0,
        "readsBytes": 8613888.0,
        "writesBytes": 30720.0,
        "receiveBytes": 648.0,
        "responseBytes": 648.0,
        "locateNodeIP": "10.10.101.65",
        "nodeSelector": null,
        "labels": {
            "app": "redis-master",
            "harmonycloud.cn/bluegreen": "redis-master-1",
            "harmonycloud.cn/projectId": "2573206d6d1f4e0c808313db80de7067",
            "pod-template-hash": "4121845993"
        },
        "persistentVolumeClaimNames": [],
        "containers": {
            "image": "10.10.103.29/onlineshop/redis-master:latest",
            "resourcesRequests": "{cpu\u003dQuantity(amount\u003d500m, format\u003dnull, additionalProperties\u003d{}), memory\u003dQuantity(amount\u003d512Mi, format\u003dnull, additionalProperties\u003d{})}",
            "resourcesLimits": "{cpu\u003dQuantity(amount\u003d500m, format\u003dnull, additionalProperties\u003d{}), memory\u003dQuantity(amount\u003d512Mi, format\u003dnull, additionalProperties\u003d{})}"
        },
        "affinity": "Affinity(nodeAffinity\u003dNodeAffinity(preferredDuringSchedulingIgnoredDuringExecution\u003d[], requiredDuringSchedulingIgnoredDuringExecution\u003dNodeSelector(nodeSelectorTerms\u003d[NodeSelectorTerm(matchExpressions\u003d[NodeSelectorRequirement(key\u003dHarmonyCloud_Status, operator\u003dIn, values\u003d[C], additionalProperties\u003d{})], additionalProperties\u003d{})], additionalProperties\u003d{}), additionalProperties\u003d{}), podAffinity\u003dnull, podAntiAffinity\u003dPodAntiAffinity(preferredDuringSchedulingIgnoredDuringExecution\u003d[], requiredDuringSchedulingIgnoredDuringExecution\u003d[], additionalProperties\u003d{}), additionalProperties\u003d{})",
        "deletionStamp": null,
        "ownerReferencesUid": "274f7ad8-e10a-11e8-bb64-005056bc6dbd",
        "toleration": [
            "Toleration(effect\u003dNoExecute, key\u003dnode.kubernetes.io/not-ready, operator\u003dExists, tolerationSeconds\u003d300, value\u003dnull, additionalProperties\u003d{})",
            "Toleration(effect\u003dNoExecute, key\u003dnode.kubernetes.io/unreachable, operator\u003dExists, tolerationSeconds\u003d300, value\u003dnull, additionalProperties\u003d{})"
        ]
    }
```

返回示例：

```json
{
    "isSucceed":true
}
```

## 6、pod数组写入

PUT /pods

| 请求参数        | 必选 | 类型     | 说明    |
| --------------- | ---- | -------- | ------- |
| （podData数组） | true | Json数组 | pod数据 |

| 返回字段  | 类型    | 说明             |
| --------- | ------- | ---------------- |
| isSucceed | Boolean | 返回是否写入成功 |

请求示例：

```json
[
	{
        "podName": "group-schedule-5ddc6df568-5zsk4",
        "podIp": "10.168.147.139",
        "nodeName": "10.10.101.66-share",
        "serviceName": "",
        "namespace": "cbl",
        "onlineType": "",
        "resourceKind": "ReplicaSet",
        "resourceName": "group-schedule-5ddc6df568",
        "state": "Running",
        "startTime": "1538295090",
        "imageName": "10.10.103.29/onlineshop/nginx:latest",
        "cpuUsage": 0.0,
        "cpuRequest": 0.0,
        "cpuLimit": 0.0,
        "memUsage": 9957376.0,
        "memRequest": 0.0,
        "memLimit": 0.0,
        "volumeType": "",
        "volumeUsage": 0.0,
        "readsBytes": 7742976.0,
        "writesBytes": 4.848367616E9,
        "receiveBytes": 9.737149462E9,
        "responseBytes": 648.0,
        "locateNodeIP": "10.10.101.66",
        "nodeSelector": null,
        "labels": {
            "app": "group-schedule",
            "pod-template-hash": "1887289124"
        },
        "PersistentVolumeClaimNames": [
            "null"
        ],
        "containers": {
            "image": "10.10.103.29/onlineshop/nginx:latest"
        },
        "affinity": "Affinity(nodeAffinity\u003dnull, podAffinity\u003dnull, podAntiAffinity\u003dPodAntiAffinity(preferredDuringSchedulingIgnoredDuringExecution\u003d[WeightedPodAffinityTerm(podAffinityTerm\u003dPodAffinityTerm(labelSelector\u003dLabelSelector(matchExpressions\u003d[LabelSelectorRequirement(key\u003dapp, operator\u003dIn, values\u003d[group-schedule], additionalProperties\u003d{})], matchLabels\u003dnull, additionalProperties\u003d{}), namespaces\u003d[cbl], topologyKey\u003dkubernetes.io/hostname, additionalProperties\u003d{}), weight\u003d50, additionalProperties\u003d{}), WeightedPodAffinityTerm(podAffinityTerm\u003dPodAffinityTerm(labelSelector\u003dLabelSelector(matchExpressions\u003d[LabelSelectorRequirement(key\u003dapp, operator\u003dIn, values\u003d[group-schedule], additionalProperties\u003d{})], matchLabels\u003dnull, additionalProperties\u003d{}), namespaces\u003d[cbl], topologyKey\u003dharmonycloud.cn/group, additionalProperties\u003d{}), weight\u003d50, additionalProperties\u003d{})], requiredDuringSchedulingIgnoredDuringExecution\u003d[], additionalProperties\u003d{}), additionalProperties\u003d{})",
        "deletionStamp": null,
        "OwnerReferencesUid": "82df0267-a4ec-11e8-acf6-005056bc6dbd",
        "toleration": [
            "Toleration(effect\u003dNoExecute, key\u003dnode.kubernetes.io/not-ready, operator\u003dExists, tolerationSeconds\u003d300, value\u003dnull, additionalProperties\u003d{})",
            "Toleration(effect\u003dNoExecute, key\u003dnode.kubernetes.io/unreachable, operator\u003dExists, tolerationSeconds\u003d300, value\u003dnull, additionalProperties\u003d{})"
        ]
    },
    {
        "podName": "redis-slave-b7b9789d7-s6f22",
        "podIp": "10.168.147.191",
        "nodeName": "10.10.101.66-share",
        "serviceName": "",
        "namespace": "gt-qas",
        "onlineType": "",
        "resourceKind": "ReplicaSet",
        "resourceName": "redis-slave-b7b9789d7",
        "state": "Running",
        "startTime": "1541429846",
        "imageName": "10.10.103.29/library/redis-slave:1.0.0",
        "cpuUsage": 4.8330804166666735E-5,
        "cpuRequest": 0.5,
        "cpuLimit": 0.5,
        "memUsage": 4.1558016E7,
        "memRequest": 5.36870912E8,
        "memLimit": 5.36870912E8,
        "volumeType": "",
        "volumeUsage": 0.0,
        "readsBytes": 3.3654784E7,
        "writesBytes": 0.0,
        "receiveBytes": 648.0,
        "responseBytes": 648.0,
        "locateNodeIP": "10.10.101.66",
        "nodeSelector": null,
        "labels": {
            "app": "redis-slave",
            "harmonycloud.cn/bluegreen": "redis-slave-1",
            "harmonycloud.cn/projectId": "2573206d6d1f4e0c808313db80de7067",
            "pod-template-hash": "636534583"
        },
        "PersistentVolumeClaimNames": [],
        "containers": {
            "image": "10.10.103.29/library/redis-slave:1.0.0",
            "resourcesRequests": "{cpu\u003dQuantity(amount\u003d500m, format\u003dnull, additionalProperties\u003d{}), memory\u003dQuantity(amount\u003d512Mi, format\u003dnull, additionalProperties\u003d{})}",
            "resourcesLimits": "{cpu\u003dQuantity(amount\u003d500m, format\u003dnull, additionalProperties\u003d{}), memory\u003dQuantity(amount\u003d512Mi, format\u003dnull, additionalProperties\u003d{})}"
        },
        "affinity": "Affinity(nodeAffinity\u003dNodeAffinity(preferredDuringSchedulingIgnoredDuringExecution\u003d[], requiredDuringSchedulingIgnoredDuringExecution\u003dNodeSelector(nodeSelectorTerms\u003d[NodeSelectorTerm(matchExpressions\u003d[NodeSelectorRequirement(key\u003dHarmonyCloud_Status, operator\u003dIn, values\u003d[C], additionalProperties\u003d{})], additionalProperties\u003d{})], additionalProperties\u003d{}), additionalProperties\u003d{}), podAffinity\u003dnull, podAntiAffinity\u003dPodAntiAffinity(preferredDuringSchedulingIgnoredDuringExecution\u003d[], requiredDuringSchedulingIgnoredDuringExecution\u003d[], additionalProperties\u003d{}), additionalProperties\u003d{})",
        "deletionStamp": null,
        "OwnerReferencesUid": "ee8f9542-e10e-11e8-bb64-005056bc6dbd",
        "toleration": [
            "Toleration(effect\u003dNoExecute, key\u003dnode.kubernetes.io/not-ready, operator\u003dExists, tolerationSeconds\u003d300, value\u003dnull, additionalProperties\u003d{})",
            "Toleration(effect\u003dNoExecute, key\u003dnode.kubernetes.io/unreachable, operator\u003dExists, tolerationSeconds\u003d300, value\u003dnull, additionalProperties\u003d{})"
        ]
    }
]
```

返回示例：

```json
{
    "isSucceed":true
}
```

## 7、获取所有service信息

GET /services

| 返回字段            | 类型       | 说明             |
| ------------------- | ---------- | ---------------- |
| （serviceData数组） | JsonObject | “”表示还没有数据 |

返回示例：

```json
[
    {
        "id": "9863ab7f-9b46-46fb-b1c9-af9fb44982b0",
        "time": "2019-01-23 02:20:32",
        "namespace": "hadoop",
        "serviceName": "hadoop-nodemanager",
        "clusterIP": "None",
        "nodePort": "null",
        "serviceType": "ClusterIP",
        "onlineType": null,
        "podNums": null,
        "podList": [
            "hadoop-nodemanager-0",
            "hadoop-nodemanager-1",
            "hadoop-nodemanager-2",
            "hadoop-nodemanager-3",
            "hadoop-nodemanager-4"
        ],
        "cpuUsage": 0.022045726870833348,
        "memUsage": 1919823872,
        "diskUsage": 0,
        "requestBytes": 49553370,
        "responseBytes": 311696195,
        "requestConnections": 0,
        "netErrors": null,
        "responseTime": null,
        "application": null,
        "resourceKind": null,
        "resourceName": null,
        "volumeType": "C",
        "volumeUsage": 0.8,
        "key": [
            "hadoop-nodemanager"
        ]
    }
]
```

## 8、获取所有service信息

GET /nodes

| 返回字段       | 类型       | 说明             |
| -------------- | ---------- | ---------------- |
| (nodeData数组) | JsonObject | “”表示还没有数据 |

返回示例：

```json
[
    {
        "id": "7bcd9a08-1fa9-4565-9ee9-6dc11aad6254",
        "time": "2019-01-23 02:20:35",
        "nodeName": "10.10.101.65-share",
        "nodeIP": "10.10.101.65",
        "cpuCores": 2,
        "cpuUsage": 1.9359166666666678,
        "allocatableCpuCores": 2,
        "memUsage": 1231237120,
        "allocatableMem": 3672203264,
        "memMaxCapacity": 3975241728,
        "diskUsage": 186394959872,
        "diskMaxCapacity": 179295641600,
        "netBandwidth": 25661.05833333333,
        "allocatablePods": 110,
        "podMaxCapacity": 110,
        "condition": "Ready",
        "labels": {
            "HarmonyCloud_Status": "C",
            "alpha.kubernetes.io/fluentd-ds-ready": "true",
            "beta.kubernetes.io/arch": "amd64",
            "beta.kubernetes.io/os": "linux",
            "harmonycloud.cn/group": "first",
            "harmonycloud.cn/redis": "redis-master1",
            "harmonycloud.cn/redis-cluster": "0",
            "harmonycloud.cn/redis-cluster1": "true",
            "kubernetes.io/hostname": "10.10.101.65-share",
            "unique": "share65"
        },
        "unschedulable": false,
        "usedPorts": null,
        "taints": "[]",
        "imageStates": null,
        "requestedVolumes": 0,
        "allocatableVolumesCount": 0,
        "nodeConditions": {
            "type": "Ready",
            "status": "True"
        },
        "preferAvoidPodsAnnotationKey": "",
        "volumeType": "C",
        "volumeUsage": 0.8,
        "key": "10.10.101.65-share"
    }
]
```

## 9、获取所有pod信息

GET /pods

| 返回字段      | 类型       | 说明             |
| ------------- | ---------- | ---------------- |
| (podData数组) | JsonObject | “”表示还没有数据 |

返回示例：

```json
[
    {
        "id": "13ee13f6-d326-42ff-8632-347766edb8bf",
        "time": "2019-01-23 02:20:37",
        "podName": "group-schedule-5ddc6df568-5zsk4",
        "podIp": "10.168.147.139",
        "nodeName": "10.10.101.66-share",
        "serviceName": "",
        "namespace": "cbl",
        "onlineType": "",
        "resourceKind": "ReplicaSet",
        "resourceName": "group-schedule-5ddc6df568",
        "state": "Running",
        "startTime": "1538295090",
        "imageName": "10.10.103.29/onlineshop/nginx:latest",
        "cpuUsage": 0,
        "cpuRequest": 0,
        "cpuLimit": 0,
        "memUsage": 9957376,
        "memRequest": 0,
        "memLimit": 0,
        "volumeType": "",
        "volumeUsage": 0,
        "readsBytes": 7742976,
        "writesBytes": 4848367616,
        "receiveBytes": 9737149462,
        "responseBytes": 648,
        "locateNodeIP": "10.10.101.66",
        "nodeSelector": null,
        "labels": {
            "app": "group-schedule",
            "pod-template-hash": "1887289124"
        },
        "persistentVolumeClaimNames": null,
        "containers": {
            "image": "10.10.103.29/onlineshop/nginx:latest"
        },
        "affinity": "Affinity(nodeAffinity=null, podAffinity=null, podAntiAffinity=PodAntiAffinity(preferredDuringSchedulingIgnoredDuringExecution=[WeightedPodAffinityTerm(podAffinityTerm=PodAffinityTerm(labelSelector=LabelSelector(matchExpressions=[LabelSelectorRequirement(key=app, operator=In, values=[group-schedule], additionalProperties={})], matchLabels=null, additionalProperties={}), namespaces=[cbl], topologyKey=kubernetes.io/hostname, additionalProperties={}), weight=50, additionalProperties={}), WeightedPodAffinityTerm(podAffinityTerm=PodAffinityTerm(labelSelector=LabelSelector(matchExpressions=[LabelSelectorRequirement(key=app, operator=In, values=[group-schedule], additionalProperties={})], matchLabels=null, additionalProperties={}), namespaces=[cbl], topologyKey=harmonycloud.cn/group, additionalProperties={}), weight=50, additionalProperties={})], requiredDuringSchedulingIgnoredDuringExecution=[], additionalProperties={}), additionalProperties={})",
        "deletionStamp": null,
        "ownerReferencesUid": null,
        "toleration": [
            "Toleration(effect=NoExecute, key=node.kubernetes.io/not-ready, operator=Exists, tolerationSeconds=300, value=null, additionalProperties={})",
            "Toleration(effect=NoExecute, key=node.kubernetes.io/unreachable, operator=Exists, tolerationSeconds=300, value=null, additionalProperties={})"
        ],
        "key": [
            "group-schedule-5ddc6df568-5zsk4",
            "cbl"
        ]
    }
]
```

# 负载预测模块

## 1、返回所有的ForecastCell

GET /forecastCellList

从数据库Mysql中取

| 返回字段           | 类型     | 说明               |
| ------------------ | -------- | ------------------ |
| (ForecastCell数组) | json数组 | 所有的ForecastCell |

返回示例：

```json
[
    {
        "id": 0,
        "cellID" : "xxx",
        "forecastingIndex" : "xxx",
        "timeInterval" : 0,
        "numberOfPerPeriod" : 0,
        "forecastingModel" : "xxx",
        "modelParams" : "xxx",
        "forcastingEndTime" : "2019-01-01 00:00:00"
    },
    {
        "id": 0,
        "cellID" : "xxx",
        "forecastingIndex" : "xxx",
        "timeInterval" : 0,
        "numberOfPerPeriod" : 0,
        "forecastingModel" : "xxx",
        "modelParams" : "xxx",
        "forcastingEndTime" : "2019-01-01 00:00:00"
    }
]
```

## 2、取某个指标的历史数据值

POST /indexData

从es中取值

| 请求参数  | 必选 | 类型                          | 说明                                                        |
| --------- | ---- | ----------------------------- | ----------------------------------------------------------- |
| type      | true | int                           | 0代表service,1代表node                                      |
| id        | true | string                        | service就是namespace&servicename  如果是node就是nodename&ip |
| index     | true | string                        | 指标名                                                      |
| startTime | true | string("yyyy-MM-dd HH:mm:ss") | 所需数据的最好时间                                          |
| endTime   | true | string("yyyy-MM-dd HH:mm:ss") | 所需数据的最晚时间                                          |

| 返回字段         | 类型     | 说明               |
| ---------------- | -------- | ------------------ |
| (DataPoint数组） | json数组 | 所有的ForecastCell |

请求示例：

```json
{
    "type" : 0,
    "id" : "xxx",
    "index" : "xxx",
    "startTime" : "2019-01-01 00:00:00",
    "endTime" : "2019-01-01 00:00:00"
}
```

返回示例：

```json
[
    {
        "value" : 0.0,
        "timeValue" : 0.000
    },
    {
        "value" : 0.0,
        "timeValue" : 0.000
    }
]
```

## 3、保存ForecastResultCell对象数组

PUT /forecastResultCells

保存到es

| 请求参数                  | 必选 | 类型     | 说明                                 |
| ------------------------- | ---- | -------- | ------------------------------------ |
| (ForecastResultCell数组） | true | json数组 | 需要保存的ForecastResultCell对象数组 |

| 返回字段  | 类型    | 说明             |
| --------- | ------- | ---------------- |
| isSucceed | Boolean | 返回是否写入成功 |

请求示例：

```json
[
    {
        "date":"2018-12-17 16:24:00",
        "forecastingIndex":"requestCount",
        "forecastResultCellID":"wordPress&wordPress0",
        "value":0.5034712915798885
    },
    {
        "date":"2018-12-17 16:32:00",
     	"forecastingIndex":"requestCount",
     	"forecastResultCellID":"wordPress&wordPress0",
     	"value":0.5694246618264088
    },
    {
        "date":"2018-12-17 16:40:00",
     	"forecastingIndex":"requestCount",
     	"forecastResultCellID":"wordPress&wordPress0",
     	"value":0.5969399230634813
    },
    {
        "date":"2018-12-17 16:48:00",
        "forecastingIndex":"requestCount",
        "forecastResultCellID":"wordPress&wordPress0",
        "value":0.6326039292850528
    },
    {
        "date":"2018-12-17 16:56:00",
     	"forecastingIndex":"requestCount",
     	"forecastResultCellID":"wordPress&wordPress0",
     	"value":0.5765058809789098
    },
    {
        "date":"2018-12-17 17:04:00",
        "forecastingIndex":"requestCount",
        "forecastResultCellID":"wordPress&wordPress0",
        "value":0.49389591747685524
    },
    {
        "date":"2018-12-17 17:12:00",
        "forecastingIndex":"requestCount",
        "forecastResultCellID":"wordPress&wordPress0",
        "value":0.48831648152369034
    },
    {
        "date":"2018-12-17 17:20:00",
        "forecastingIndex":"requestCount",
        "forecastResultCellID":"wordPress&wordPress0",
        "value":0.4912936189652358
    }
]
```

返回示例：

```json
{
    "isSucceed":true
}
```

# 应用画像接口

## 1、获得服务-Pod层级关系接口

GET /service/allPodName

| 请求参数    | 必选 | 类型   | 说明       |
| ----------- | ---- | ------ | ---------- |
| namespace   | true | string | 命名空间   |
| serviceName | true | string | 服务名     |
| clusterIP   | true | string | 服务内部IP |

| 返回字段        | 类型     | 说明            |
| --------------- | -------- | --------------- |
| （podName数组） | json数组 | 返回podName数组 |

请求示例：

```json
/service/allPodName?namespace=hadoop&serviceName=hadoop-datanode-web&clusterIP=10.97.210.52
```

返回示例：

```json
[
    "hadoop-datanode-0",
    "hadoop-datanode-1"
]
```

## 2、获得Service的存储卷信息接口

GET /service/storageVolume

| 请求参数    | 必选 | 类型   | 说明       |
| ----------- | ---- | ------ | ---------- |
| namespace   | true | string | 命名空间   |
| serviceName | true | string | 服务名     |
| clusterIP   | true | string | 服务内部IP |

| 返回字段    | 类型       | 说明         |
| ----------- | ---------- | ------------ |
| volumeType  | json字符串 | 为存储卷类型 |
| volumeUsage | json字符串 | 存储卷大小   |

请求示例：

```json
/service/storageVolume?namespace=hadoop&serviceName=hadoop-datanode-web&clusterIP=10.97.210.52
```

返回示例：

```json
{
    "volumeType": "C",
    "volumeUsage": 0.8
}
```

## 3、获得应用-服务层级关系接口

GET /application/allServiceNames

从普罗米修斯数据库中查询并返回指定应用包括的服务名称

| 请求参数  | 必选 | 类型   | 说明     |
| --------- | ---- | ------ | -------- |
| namespace | true | string | 命名空间 |

| 返回字段             | 类型     | 说明                                                         |
| -------------------- | -------- | ------------------------------------------------------------ |
| （servicesName数组） | json数组 | 该接口总体返回一个对象数组，每个对象数据只有ServicesName属性 |

请求示例：

```json
/application/allServiceNames?namespace=xxx
```

返回示例：

```json
["10086APP","mobileShop"]
```

## 4、获得Node的Conditions

GET /node/nodeConditions

从普罗米修斯数据库中查询并返回指定Node包括的Conditions值

| 请求参数 | 必选 | 类型   | 说明         |
| -------- | ---- | ------ | ------------ |
| nodeName | true | string | 节点主机名称 |
| nodeIP   | true | string | 节点物理IP   |

| 返回字段       | 类型       | 说明 |
| -------------- | ---------- | ---- |
| nodeConditions | json字符串 |      |

请求示例：

```json
/node/nodeConditions?nodeName=xxx&nodeIP=xxx
```

返回示例：

```json
{
    "nodeConditions": {
        "type": "Ready",
        "status": "True"
    }
}
```

# 应用画像模块获取数据接口

## 1、获得当前指定service的系统实时pod实例数

GET /service/podNums

从普罗米修斯获得当前已在运行状态指定服务的pod实例数

| 请求参数    | 必选 | 类型   | 说明               |
| ----------- | ---- | ------ | ------------------ |
| namespace   | true | string | 服务所在的命名空间 |
| serviceName | true | string | 服务名             |
| clusterIP   | true | string | 服务内部IP         |

| 返回字段 | 类型 | 说明 |
| -------- | ---- | ---- |
| podNums  | int  |      |

请求示例：

```json
/service/podNums?namespace=xxx&serviceName=xxx&clusterIP=xxx
```

返回示例：

```json
{
    "podNums": 22
}
```

## 2、获取指定service的实时网络IO流量

GET /service/netVolume

从普罗米修斯返回service的实时网络上传流量和下载流量

| 请求参数    | 必选 | 类型   | 说明               |
| ----------- | ---- | ------ | ------------------ |
| namespace   | true | string | 服务所在的命名空间 |
| serviceName | true | string | 服务名             |
| clusterIP   | true | string | 服务内部IP         |

| 返回字段      | 类型   | 说明                    |
| ------------- | ------ | ----------------------- |
| requestBytes  | double | 单位：Bytes/s(下行速率) |
| responseBytes | double | 单位：Bytes/s(上行速率) |

请求示例：

```json
/service/netVolume?namespace=xxx&serviceName=xxx&clusterIP=xxx
```

返回示例：

```json
{
    "responseBytes": 1225023,
    "requestBytes": 1782744
}
```

## 3、获得指定服务的相应时间段的CPU,mem,网络上行速率，网络下载速率值

GET /service/resourceConsume

从普罗米修斯返回service的实时网络上传流量和下载流量

| 请求参数    | 必选 | 类型                        | 说明               |
| ----------- | ---- | --------------------------- | ------------------ |
| namespace   | true | string                      | 服务所在的命名空间 |
| serviceName | true | string                      | 服务名             |
| clusterIP   | true | string                      | 服务内部IP         |
| startTime   | true | string(yyyy-MM-dd HH:mm:ss) | 记录开始时间       |
| endTime     | true | string(yyyy-MM-dd HH:mm:ss) | 记录结束时间       |

| 返回字段      | 类型   | 说明                    |
| ------------- | ------ | ----------------------- |
| requestBytes  | double | 单位：Bytes/s(下行速率) |
| responseBytes | double | 单位：Bytes/s(上行速率) |
| time          | string | 记录时间                |
| cpuUsage      | double | CPU占用情况             |
| memUsage      | double | 内存占用情况            |

请求示例：

```json
/service/resourceCosume?namespace=xxx&serviceName=xxx&clusterIP=xxx&startTime=xxx&endTime=xxx
```

返回示例：

```json
[
    {
        "cpuUsage": 0.0022282224041666986,
        "responseBytes": 1225023,
        "requestBytes": 1782744,
        "memUsage": 384671744,
        "time": "2019-01-28 23:31:04"
    },
    {
        "cpuUsage": 0.0022282224041666986,
        "responseBytes": 1225023,
        "requestBytes": 1782744,
        "memUsage": 384671744,
        "time": "2019-01-29 00:01:28"
    }
]
```

## 4、获得指定服务的相应时间段的服务单位时间请求数及实例数

GET /service/loadMappingInstances

从普罗米修斯数据库中给定时间范围查询指定服务单位时间请求数及实例数

| 请求参数    | 必选 | 类型                        | 说明               |
| ----------- | ---- | --------------------------- | ------------------ |
| namespace   | true | string                      | 服务所在的命名空间 |
| serviceName | true | string                      | 服务名             |
| clusterIP   | true | string                      | 服务内部IP         |
| startTime   | true | string(yyyy-MM-dd HH:mm:ss) | 记录开始时间       |
| endTime     | true | string(yyyy-MM-dd HH:mm:ss) | 记录结束时间       |

| 返回字段           | 类型   | 说明                |
| ------------------ | ------ | ------------------- |
| time               | string | 记录时间            |
| requestConnections | Long   | 服务单位时间请求数  |
| podNums            | Long   | 相应服务的Pod实例数 |

请求示例：

```json
/service/loadMappingInstances?namespace=xxx&serviceName=xxx&clusterIP=xxx&startTime=xxx&endTime=xxx
```

返回示例：

```json
[
    {
        "requestConnections": 10,
        "podNums": 22,
        "time": "2019-01-29 00:25:21"
    },
    {
        "requestConnections": 10,
        "podNums": 22,
        "time": "2019-01-29 00:24:39"
    }
]
```

## 5、实时获得指定服务的单位时间请求数响应时间平均值（衡量Qos）

GET /service/responseTime

从普罗米修斯数据库获得当前单位时间服务请求的平均响应时间

| 请求参数    | 必选 | 类型   | 说明               |
| ----------- | ---- | ------ | ------------------ |
| namespace   | true | string | 服务所在的命名空间 |
| serviceName | true | string | 服务名             |
| clusterIP   | true | string | 服务内部IP         |

| 返回字段     | 类型   | 说明               |
| ------------ | ------ | ------------------ |
| responseTime | Double | 请求数响应平均时间 |

请求示例：

```json
/service/responseTime?namespace=xxx&serviceName=xxx&clusterIP=xxx
```

返回示例：

```json
{
    "responseTime": 13
}
```

# 场景分析模块

## 1、获得所有service和node的所有指标的预测数据

GET /forecast/forecastValues

| 请求参数  | 必选 | 类型                        | 说明 |
| --------- | ---- | --------------------------- | ---- |
| startTime | true | string(yyyy-MM-dd HH:mm:ss) |      |
| endTime   | true | string(yyyy-MM-dd HH:mm:ss) |      |

| 返回字段                      | 类型     | 说明 |
| ----------------------------- | -------- | ---- |
| (ServiceLoad与NodeLoad的数组) | json数组 |      |

请求示例：

```json
/forecast/forecastValues?startTime=2019-01-01 00:00:00&endTime=2019-02-01 00:00:00
```

返回示例：

```json
[
    {
        "endTime": "2019-02-01 00:00:00",
        "errorRate": null,
        "namespace": "hadoop",
        "normalErrorRate": 0,
        "normalTimeResponse": 0,
        "requestNumber": 0,
        "serviceName": "hadoop-datanode",
        "startTime": "2019-01-01 00:00:00",
        "timeResponse": null
    },
    {
        "endTime": "2019-02-01 00:00:00",
        "errorRate": null,
        "namespace": "hadoop",
        "normalErrorRate": 0,
        "normalTimeResponse": 0,
        "requestNumber": 0,
        "serviceName": "hadoop-datanode-web",
        "startTime": "2019-01-01 00:00:00",
        "timeResponse": null
    },
    {
        "cpuUsage": 1.9359166666666678,
        "diskUsage": 186394959872,
        "endTime": "2019-02-01 00:00:00",
        "memUsage": 1231237120,
        "nodeIP": "10.10.101.65",
        "startTime": "2019-01-01 00:00:00"
    },
    {
        "cpuUsage": 1.9906666666666653,
        "diskUsage": 186394959872,
        "endTime": "2019-02-01 00:00:00",
        "memUsage": 1112883200,
        "nodeIP": "10.10.101.66",
        "startTime": "2019-01-01 00:00:00"
    }
]
```



# Scheduler接口

## 1、获取Service的管理方式信息

GET /management

从数据库Mysql中service中取

| 请求参数    | 必选 | 类型   | 说明     |
| ----------- | ---- | ------ | -------- |
| namespace   | true | string | 命名空间 |
| serviceName | true | string | 服务名   |

| 返回字段  | 类型       | 说明 |
| --------- | ---------- | ---- |
| ownerType | json字符串 |      |
| ownerName | json字符串 |      |

请求示例：

```json
/management?namespace=xxx&servicename=xxx
```

返回示例：

```json
{
    "ownerType": "C",
    "ownerName": "cpu"
}
```

# 调度算法模块

## 1、获取schedulePod数组

GET /schedulePods

| 返回字段            | 类型       | 说明             |
| ------------------- | ---------- | ---------------- |
| （schedulePod数组） | JsonObject | “”表示还没有数据 |

返回示例：

```json
[
    {
        "id":"xxx",
        "operation":1,
        "namespace":"xxx",
        "serviceName":"xxx",
        "number":2
    },
    {
        "id":"xxx",
        "operation":2,
        "namespace":"xxx",
        "serviceName":"xxx",
        "number":23
    }
]
```

## 2、schedulePod数组写入

PUT /schedulePods

| 请求参数            | 必选 | 类型     | 说明            |
| ------------------- | ---- | -------- | --------------- |
| （schedulePod数组） | true | Json数组 | schedulePod数据 |

| 返回字段  | 类型    | 说明             |
| --------- | ------- | ---------------- |
| isSucceed | Boolean | 返回是否写入成功 |

请求示例：

```json
[
	{
        "operation":1,
        "namespace":"xxx",
        "serviceName":"xxx",
        "number":2
    },
    {
        "operation":2,
        "namespace":"xxx",
        "serviceName":"xxx",
        "number":23
    }
]
```

返回示例：

```json
{
    "isSucceed":true
}
```

# 调控模块接口

## 1、获取当前node数据

GET /nowNode

|   返回字段    |   类型   |
| :-----------: | :------: |
| NowNode的数组 | json数组 |

json字段说明 
     

|   键名   |  类型   |           说明           |
| :------: | :-----: | :----------------------: |
| hostName | String  | 对应node监控数据nodeName |
|  hostIP  | String  |  对应node监控数据nodeIP  |
| podNums  | Integer | 对应node监控数据podNums  |
| cpuUsage | Double  | 对应node监控数据cpuUsage |
| memUsage | Double  | 对应node监控数据memUsage |

返回示例：

```json
[
    {
        "hostName": "10.10.101.65-share",
        "hostIP": "10.10.101.65",
        "podNums": 15,
        "cpuUsage": 1.9429166666652755,
        "memUsage": 9.45537024E8
    }
]
```

## 4、获取当前service数据

GET /nowService

|     返回字段     |   类型   |
| :--------------: | :------: |
| NowService的数组 | json数组 |

json字段说明 
     

|    键名     |  类型   |                             说明                             |
| :---------: | :-----: | :----------------------------------------------------------: |
|  namespace  | String  |                 对应service监控数据namespace                 |
| serviceName | String  |                对应service监控数据serviceName                |
|   podNums   | Integer |                  对应service监控数据podNums                  |
|  cpuUsage   | Double  |                 对应service监控数据cpuUsage                  |
|  memUsage   | Double  |                 对应service监控数据memUsage                  |
|  isOffline  | Boolean | 对应service监控数据onlineType,onlineType为"1",则为True,否则反之 |

返回示例：

```json
[
    {
        "namespace": "wordpress",
        "serviceName": "wordpress-wp",
        "podNums": 2,
        "cpuUsage": 1.0691560357753402E-4,
        "memUsage": 2.46792192E8,
        "isOffline": false
    }
]
```

# 其他测试接口

## 1、一条ResultPod写入

PUT /resultPod

## 2、ResultPods数组写入

PUT /resultPods

## 3、获取所有ResultPod

GET /resultPods

## 4、一条ResultNode

PUT /resultNode

## 5、ResultNodes数组写入

PUT /resultNodes

## 6、获取所有ResultNode

GET /resultNodes

