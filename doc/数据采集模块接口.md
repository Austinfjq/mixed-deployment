#数据采集
 
## 1. 写入ES的接口

    写入service数据    PUT /services

    写入pod数据    PUT /pods

    写入node数据    PUT /nodes

## 2. 获取数据信息

### （1） 获取当前系统service信息

    GET /services

####json字段说明 
     
|        键名        |       类型        |             说明             |
| :----------------: | :---------------: | :--------------------------: |
|     namespace      |      String       |      服务所属namespace       |
|    serviceName     |      String       |            服务名            |
|     clusterIP      |      String       |        服务ClusterIP         |
|      nodePort      |      String       |         服务nodePort         |
|    serviceType     |      String       |           服务类型           |
|     onlineType     |      String       | 服务离在线类型，离线1，在线0 |
|      podNums       |       Long        |          服务pod数           |
|      podList       | ArrayList<String> |        服务下pod列表         |
|      cpuUsage      |      Double       |        服务cpu使用量         |
|      memUsage      |      Double       |        服务内存使用量        |
|     diskUsage      |      Double       |        服务磁盘使用量        |
|    requestBytes    |      Double       |         服务请求流量         |
|   responseBytes    |      Double       |         服务响应流量         |
| requestConnections |       Long        |        服务请求连接数        |
|     netErrors      |       Long        |        服务网络错误数        |
|    application     |      Double       |         服务对应应用         |
|    resourceKind    |      String       |        服务owner类型         |
|    resourceName    |      String       |         服务owner名          |


#### 示例
```json
[
    {
        "application": 0,
        "clusterIP": "10.101.3.215",
        "cpuUsage": 1.0691560357753402E-4,
        "diskUsage": 0.0,
        "key": [
            "wordpress-wp",
            "wordpress"
        ],
        "memUsage": 2.46792192E8,
        "namespace": "wordpress",
        "netErrors": 0,
        "nodePort": "null",
        "onlineType": "",
        "podList": [
            "wordpress-9975cc66-4vxx9",
            "wordpress-9975cc66-gp9p4"
        ],
        "podNums": 2,
        "requestBytes": 1.32349828E8,
        "requestConnections": 0,
        "resourceKind": "Deployment",
        "resourceName": "wordpress",
        "responseBytes": 1.71660481E8,
        "responseTime": 5.973,
        "serviceName": "wordpress-wp",
        "serviceType": "ClusterIP"
    }
]
```

### （2） 获取当前系统pod信息

    GET /pods

#### json字段说明    
|            键名            |        类型         |            说明             |
| :------------------------: | :-----------------: | :-------------------------: |
|          podName           |       String        |            pod名            |
|           podIp            |       String        |          pod对应IP          |
|          nodeName          |       String        |        pod对应节点名        |
|        serviceName         |       String        |      pod所属service名       |
|         namespace          |       String        |    pod所属服务namespace     |
|         onlineType         |       String        | pod离在线类型，离线1，在线0 |
|        resourceKind        |       String        |      pod对应owner类型       |
|        resourceName        |       String        |       pod对应owner名        |
|           state            |       String        |         pod对应状态         |
|         startTime          |       String        |         pod起始时间         |
|         imageName          |       String        |        pod对应镜像名        |
|          cpuUsage          |       Double        |       pod的cpu使用量        |
|         cpuRequest         |       Double        |     pod cpu的request值      |
|          cpuLimit          |       Double        |      pod cpu的limit值       |
|          memUsage          |       Double        |       pod的mem使用量        |
|         memRequest         |       Double        |     pod mem的request值      |
|          memLimit          |       Double        |      pod mem的limit值       |
|         volumeType         |       String        |        pod存储卷类型        |
|        volumeUsage         |       Double        |        pod存储使用量        |
|         readsBytes         |       Double        |       pod读入字节总数       |
|        writesBytes         |       Double        |       pod写入字节总数       |
|        receiveBytes        |       Double        |      Pod网络请求字节数      |
|       responseBytes        |       Double        |      Pod网络传输字节数      |
|        locateNodeIP        |       String        |        Pod所在节点ip        |
|        nodeSelector        | Map<String, String> |     Pod对应nodeSelector     |
|           labels           | Map<String, String> |        Pod对应labels        |
| persistentVolumeClaimNames |  ArrayList<String>  |        Pod下所有pvc         |
|         containers         | Map<String, String> |     Pod下所有Container      |
|          affinity          |       String        |       所有亲和性参数        |
|       deletionStamp        |       String        |         删除时间戳          |
|     ownerReferencesUid     |       String        |       pod的Owner信息        |
|         toleration         |  ArrayList<String>  |      对node的容忍条件       |
|         netErrors          |        Long         |        pod网络错误数        |



#### 示例
```json
[
    {
        "affinity": "Affinity(nodeAffinity=null, podAffinity=null, podAntiAffinity=PodAntiAffinity(preferredDuringSchedulingIgnoredDuringExecution=[WeightedPodAffinityTerm(podAffinityTerm=PodAffinityTerm(labelSelector=LabelSelector(matchExpressions=[LabelSelectorRequirement(key=app, operator=In, values=[group-schedule], additionalProperties={})], matchLabels=null, additionalProperties={}), namespaces=[cbl], topologyKey=kubernetes.io/hostname, additionalProperties={}), weight=50, additionalProperties={}), WeightedPodAffinityTerm(podAffinityTerm=PodAffinityTerm(labelSelector=LabelSelector(matchExpressions=[LabelSelectorRequirement(key=app, operator=In, values=[group-schedule], additionalProperties={})], matchLabels=null, additionalProperties={}), namespaces=[cbl], topologyKey=harmonycloud.cn/group, additionalProperties={}), weight=50, additionalProperties={})], requiredDuringSchedulingIgnoredDuringExecution=[], additionalProperties={}), additionalProperties={})",
        "containers": {
            "image": "10.10.103.29/onlineshop/nginx:latest",
            "ports": "[]"
        },
        "cpuLimit": 0.0,
        "cpuRequest": 0.0,
        "cpuUsage": 0.0,
        "deletionStamp": "",
        "imageName": "10.10.103.29/onlineshop/nginx:latest",
        "key": [
            "group-schedule-5ddc6df568-fwnzj",
            "cbl"
        ],
        "labels": {
            "app": "group-schedule",
            "pod-template-hash": "1887289124"
        },
        "locateNodeIP": "10.10.102.27",
        "memLimit": 0.0,
        "memRequest": 0.0,
        "memUsage": 1.0522624E7,
        "namespace": "cbl",
        "netErrors": 0,
        "nodeName": "10.10.103.27-slave",
        "nodeSelector": null,
        "onlineType": "",
        "ownerReferencesUid": "",
        "persistentVolumeClaimNames": [
            "null"
        ],
        "podIp": "10.168.101.32",
        "podName": "group-schedule-5ddc6df568-fwnzj",
        "readsBytes": 7775744.0,
        "receiveBytes": 648.0,
        "resourceKind": "Deployment",
        "resourceName": "group-schedule",
        "responseBytes": 1.327409246703E12,
        "serviceName": "",
        "startTime": "1549591871",
        "state": "Running",
        "toleration": [
            "Toleration(effect=NoExecute, key=node.kubernetes.io/not-ready, operator=Exists, tolerationSeconds=300, value=null, additionalProperties={})",
            "Toleration(effect=NoExecute, key=node.kubernetes.io/unreachable, operator=Exists, tolerationSeconds=300, value=null, additionalProperties={})"
        ],
        "volumeType": "",
        "volumeUsage": 0.0,
        "writesBytes": 7.2272124928E10
    }
]
```

### （3） 获取当前系统node信息

    GET /nodes

#### json字段说明    
|             键名             |        类型         |         说明         |
| :--------------------------: | :-----------------: | :------------------: |
|           nodeName           |       String        |        节点名        |
|            nodeIP            |       String        |        节点IP        |
|           cpuCores           |       Double        |     节点cpu核数      |
|           cpuUsage           |       Double        |    节点cpu使用率     |
|     allocatableCpuCores      |       Double        |   节点可用cpu核数    |
|           memUsage           |       Double        |    节点内存使用量    |
|        allocatableMem        |       Double        |  节点可用内存字节数  |
|        memMaxCapacity        |       Double        |    节点内存总容量    |
|          diskUsage           |       Double        |    节点磁盘使用量    |
|       diskMaxCapacity        |       Double        |    节点磁盘总容量    |
|         netBandwidth         |       Double        |     节点网络带宽     |
|       allocatablePods        |       Double        |   节点可用pod数量    |
|        podMaxCapacity        |       Double        |   节点最大pod数量    |
|          condition           |       String        |   节点pressure状态   |
|            labels            | Map<String, String> |       节点标签       |
|        unschedulable         |       boolean       |     节点可调度性     |
|          usedPorts           | Map<String, String> |   节点已使用的端口   |
|            taints            |       String        |      节点taints      |
|         imageStates          | Map<String, String> |     节点镜像状态     |
|       requestedVolumes       |       Double        | 在节点上需要的卷数量 |
|   allocatableVolumesCount    |       Double        |  节点上可分配卷数量  |
|        nodeConditions        | Map<String, String> |    节点Condition     |
| preferAvoidPodsAnnotationKey |       String        |  节点避免Pod的注释   |


#### 示例
```json
[
    {
        "allocatableCpuCores": 2.0,
        "allocatableMem": 3.672203264E9,
        "allocatablePods": 110.0,
        "allocatableVolumesCount": 0.0,
        "condition": "Ready",
        "cpuCores": 2.0,
        "cpuUsage": 1.9429166666652755,
        "diskMaxCapacity": 1.76986640384E11,
        "diskUsage": 1.86394959872E11,
        "imageStates": null,
        "key": "10.10.101.65-share",
        "labels": {
            "HarmonyCloud_Status": "C",
            "alpha.kubernetes.io/fluentd-ds-ready": "true",
            "beta.kubernetes.io/arch": "amd64",
            "beta.kubernetes.io/os": "linux",
            "harmonycloud.cn/group": "first",
            "harmonycloud.cn/redis": "redis-master1",
            "harmonycloud.cn/redis-cluster": "0",
            "harmonycloud.cn/redis-cluster1": "true",
            "kubernetes.io/hostname": "10.10.101.65-share",
            "unique": "share65"
        },
        "memMaxCapacity": 3.975241728E9,
        "memUsage": 9.45537024E8,
        "netBandwidth": 4974.966666666666,
        "nodeConditions": {
            "type": "Ready",
            "status": "True"
        },
        "nodeIP": "10.10.101.65",
        "nodeName": "10.10.101.65-share",
        "podMaxCapacity": 110.0,
        "preferAvoidPodsAnnotationKey": "",
        "requestedVolumes": 0.0,
        "taints": "[]",
        "unschedulable": false,
        "usedPorts": {
            "9100": "TCP"
        }
    }
]
```
